<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“–</text></svg>">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storybook</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="app">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h1>Storybook</h1>
            <p>Story-to-Shorts Pipeline</p>
        </div>
        <div class="sidebar-nav">
            <button data-view="create" class="active">+ New Story</button>
            <button data-view="timeline">Timeline</button>
            <button data-view="world-bible">World Bible</button>
        </div>
        <div class="story-list" id="story-list"></div>
    </nav>

    <!-- Main -->
    <div class="main">
        <!-- Header -->
        <div class="header">
            <h2 id="header-title">Storybook</h2>
            <div class="header-actions">
                <button class="btn btn-secondary btn-sm" id="btn-segment">Segment</button>
                <button class="btn btn-secondary btn-sm" id="btn-extract-world">Extract World</button>
                <button class="btn btn-secondary btn-sm" id="btn-breakdown">Breakdown All</button>
                <button class="btn btn-secondary btn-sm" id="btn-prompts" disabled>Build Prompts</button>
                <button class="btn btn-primary btn-sm" id="btn-generate" disabled>Generate All</button>
                <button class="btn btn-secondary btn-sm" id="btn-generate-videos" disabled>Generate Videos</button>
            </div>
        </div>

        <div class="content">
            <!-- Create Story View -->
            <div id="view-create" class="view active">
                <div style="max-width:700px;">
                    <h3 style="margin-bottom:16px;">Create New Story</h3>
                    <form id="create-story-form">
                        <div class="form-group">
                            <label>Title</label>
                            <input name="title" placeholder="e.g. Frozen Head of the P.O.T.U.S. â€” Chapter 1">
                        </div>
                        <div class="form-group">
                            <label>Story Text</label>
                            <textarea name="raw_text" placeholder="Paste your story text here..." rows="12"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Visual Style (optional)</label>
                            <textarea name="visual_style" placeholder="e.g. Dark cinematic sci-fi, neon-lit corridors, Blade Runner meets political thriller. High contrast lighting, deep shadows. Characters shown from dramatic angles." rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Music Style (optional)</label>
                            <input name="music_style" placeholder="e.g. Tense electronic ambient, Hans Zimmer-style percussive hits">
                        </div>
                        <button type="submit" class="btn btn-primary">Create Story</button>
                    </form>
                </div>
            </div>

            <!-- Timeline View -->
            <div id="view-timeline" class="view">
                <div class="timeline">
                    <!-- Lane 1: Source Text -->
                    <div class="lane" id="lane-source">
                        <div class="lane-header">Source Text</div>
                        <div class="lane-scroll">
                            <div class="source-strip" id="source-strip">
                                <div style="color:var(--text-dim)">No story loaded</div>
                            </div>
                        </div>
                    </div>

                    <div class="resize-handle" data-above="lane-source" data-below="lane-scenes"></div>

                    <!-- Lane 2: Scene Cards -->
                    <div class="lane" id="lane-scenes">
                        <div class="lane-header">Scenes</div>
                        <div class="lane-scroll">
                            <div class="scene-cards" id="scene-cards"></div>
                        </div>
                    </div>

                    <div class="resize-handle" data-above="lane-scenes" data-below="lane-shots"></div>

                    <!-- Lane 3: Shot Cards -->
                    <div class="lane" id="lane-shots">
                        <div class="lane-header">Shots</div>
                        <div class="lane-scroll">
                            <div class="shot-cards" id="shot-cards"></div>
                        </div>
                    </div>

                    <div class="resize-handle" data-above="lane-shots" data-below="detail-panel"></div>

                    <!-- Detail Panel -->
                    <div class="detail-panel" id="detail-panel">
                        <div class="empty-state">
                            <div class="icon">&#9661;</div>
                            <h3>Select a scene or shot</h3>
                            <p>Click on a scene card to view its details, or select a shot to edit visual direction and prompts.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- World Bible View -->
            <div id="view-world-bible" class="view">
                <div class="wb-container" id="wb-container">
                    <div class="wb-empty-state" id="wb-empty">
                        <div class="empty-state">
                            <div class="icon">&#127760;</div>
                            <h3>No World Bible Yet</h3>
                            <p>Click "Extract World" in the header to analyze your story and extract characters, locations, props, and camera style.</p>
                        </div>
                    </div>
                    <div class="wb-content" id="wb-content" style="display:none;">
                        <div class="wb-tabs">
                            <button class="wb-tab active" data-tab="characters">Characters</button>
                            <button class="wb-tab" data-tab="locations">Locations</button>
                            <button class="wb-tab" data-tab="props">Props</button>
                            <button class="wb-tab" data-tab="camera">Camera</button>
                        </div>
                        <div class="wb-layout">
                            <div class="wb-list" id="wb-list"></div>
                            <div class="wb-detail" id="wb-detail">
                                <div class="empty-state"><p>Select an entity to view details</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="toast-container" id="toast-container"></div>

<script src="/static/js/state.js"></script>
<script src="/static/js/api.js"></script>
<script src="/static/js/ws.js"></script>
<script src="/static/js/world-bible.js"></script>
<script src="/static/js/app.js"></script>
</body>
</html>
